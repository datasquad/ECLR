<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Time-Series Modelling</title>

<script src="site_libs/header-attrs-2.28/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">HOME</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="examples.html">Examples</a>
</li>
<li>
  <a href="Datasets.html">Datasets</a>
</li>
<li>
  <a href="resources.html">Resources</a>
</li>
<li>
  <a href="Author.html">Author</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Time-Series Modelling</h1>

</div>


<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>In this section you will learn how to handle time-series data, how to
identify some basic characteristics of time-series data and how to do
some basic modelling.</p>
</div>
<div id="packages-and-codes-used" class="section level1">
<h1>Packages and codes used</h1>
<p>We shall use and load the following packages:</p>
<pre class="r"><code>library(tidyverse)
library(ggplot2)
library(pdfetch)    # allows direct access to data
library(xts)        # time series formatting
library(AER)        # access to HS robust standard errors
library(stargazer)  # delivers nice regresison output
library(gridExtra)  # required for the combination of ggplots</code></pre>
<p>We will also use two functions saved in .r files. The function of
these two files will be explained below. These are available for
download from here: <a
href="https://github.com/datasquad/ECLR/blob/gh-pages/docs/stargazer_HC.R">stargazer_HC.R</a>
and <a
href="https://github.com/datasquad/ECLR/blob/gh-pages/docs/stargazer_HAC.R">stargazer_HAC.R</a>.</p>
<p>When you get to that page you will see a download button.</p>
<p><img src="images/GitHubdownload.png" /></p>
<p>You should save these two files into your working directory. Once
they are there, you can make these functions available to your code
using these two lines.</p>
<pre class="r"><code>source(&quot;stargazer_HC.r&quot;)  # includes the robust regression display
source(&quot;stargazer_HAC.r&quot;)  # includes the Newey-West standard errors</code></pre>
</div>
<div id="a-single-time-series" class="section level1">
<h1>A single time series</h1>
<div id="import-data" class="section level2">
<h2>Import data</h2>
<p>We shall use some data from the Office for National Statistics (ONS)
in the UK. The <code>pdfetch</code> package delivers direct access to
the data of the ONS. When you get data from the ONS you need to know
what the series id is and in which ONS dataset you can find these data.
The way to find out what that info is it is best to go to <a
href="https://www.ons.gov.uk/timeseriestool">the ONS time series
tool</a>. YOu can find more detail on how to use this tool from <a
href="https://datasquad.github.io/ECLR/R_DataDownload.html">here</a>.</p>
<p>For instance we can get real GDP data (id: AMBI) from the UKEA
databank.</p>
<pre class="r"><code>rGDP &lt;- pdfetch_ONS(&quot;ABMI&quot;,&quot;UKEA&quot;)  # reference the database and then the series id
periodicity(rGDP)                   # check data availability</code></pre>
<pre><code>## Quarterly periodicity from 1955-03-31 to 2024-06-30</code></pre>
<pre class="r"><code>names(rGDP) &lt;- &quot;real GDP&quot;           # give a sensible name

# keep all the data including 2022-Q4
# remove this line if you want to use updated data
rGDP &lt;- rGDP[&quot;/2022-12&quot;]  </code></pre>
<p>The format in which the <code>pdfetch</code> function returns the
data is the <code>xts</code> format. This is a format that recognises
that the data are a time-series. If you look at the index of the series
(<code>index(rGDP)</code>), R will show you all the dates.</p>
</div>
<div id="time-series-plots" class="section level2">
<h2>Time series plots</h2>
<p>You can plot this series in a straightforward manner using the
build-in <code>plot</code> function.</p>
<pre class="r"><code>plot(rGDP)</code></pre>
<p><img src="R_TS_Modelling_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>But if you want to use the power of the <code>ggplot</code> function
you will have to restructure the data slightly. The reason being that,
to create a line plot in <code>ggplot</code> we need the date as an
actual variable. In <code>rGDP</code> the date is packed into the
index.</p>
<p>Below is how we do that. <code>index(rGDP)</code> extracts the date
and uses it as the first variable in a new dataframe
<code>rGDP_l</code>. Check out the help function <code>?stack</code> to
better understand what the next piece of code does and how it creates
the 2nd and third variable in the new dataframe..</p>
<pre class="r"><code># we prepare the data for being kept in long format
# that is useful for plotting in ggplot
rGDP_l &lt;- data.frame(index(rGDP),stack(as.data.frame(coredata(rGDP))))
# Give sensible names to columns
names(rGDP_l)[1] &lt;- &quot;Date&quot;   # first col will have date
names(rGDP_l)[2] &lt;- &quot;Value&quot;  # second col will have value
names(rGDP_l)[3] &lt;- &quot;id&quot;     # third col will have series name</code></pre>
<p>Now we can use the <code>geom_line()</code> plot to create a line
plot:</p>
<pre class="r"><code>ggplot(rGDP_l,aes(x =Date, y=Value)) + 
  geom_line(colour = &quot;blue&quot;,size = 1.5) +
  ggtitle(&quot;UK real GDP&quot;) +
  theme_bw()</code></pre>
<p><img src="R_TS_Modelling_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>If you want to plot a subsample of the data only, the easiest way to
do that is to use the <code>subset</code> function as you call the data
into the <code>ggplot</code> function. Compare what has changed in the
code and figure out what the <code>subset</code> function did.</p>
<pre class="r"><code>ggplot(subset(rGDP_l, Date &gt;&quot;2000-01-01&quot;),aes(x =Date, y=Value)) + 
  geom_line(colour = &quot;blue&quot;,size = 1.5) +
  ggtitle(&quot;UK real GDP&quot;) +
  theme_bw()</code></pre>
<p><img src="R_TS_Modelling_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="autocorrelation-function-acf" class="section level2">
<h2>Autocorrelation function (ACF)</h2>
<p>Let’s calculate the autocorrelation function. The autocorrelation
function tells you how the a series <span
class="math inline">\(y_t\)</span> is correlated with itself <span
class="math inline">\(k\)</span> periods prior, <span
class="math inline">\(corr(y_t,y_{t-k})\)</span>, for a range of values
of <span class="math inline">\(k\)</span>. The <code>acf</code> function
easily achieves this:</p>
<pre class="r"><code>temp_acf &lt;- acf(rGDP)</code></pre>
<p><img src="R_TS_Modelling_files/figure-html/unnamed-chunk-9-1.png" width="672" />
Note that the first value shown is for <span
class="math inline">\(k=0\)</span> and hence the function always starts
at <span class="math inline">\(corr(y_t,y_{t-0})=1\)</span>.</p>
</div>
</div>
<div id="multiple-time-series" class="section level1">
<h1>Multiple time series</h1>
<p>Often we will deal with multiple time-series. Now you will learn how
to deal with multiple series, store the data, plot them and calculate
ACFs.</p>
<p>We download female unemployment rates and monthly inflation rates
from the ONS database. On both occasions we put the data into the long
format.</p>
<pre class="r"><code># Download: Female unemployment rate (YCPL in database LMS)
ur_female &lt;- pdfetch_ONS(&quot;YCPL&quot;,&quot;LMS&quot;)
names(ur_female) &lt;- &quot;Unemp Rate (female)&quot;
periodicity(ur_female)</code></pre>
<pre><code>## Monthly periodicity from 1992-04-30 to 2024-06-30</code></pre>
<pre class="r"><code># keep all the data including 2022-Jan
# this was the last observation available at the time this was written
# remove this line if you want to use updated data
ur_female &lt;- ur_female[&quot;/2022-12&quot;]  

ur_female_l &lt;- data.frame(index(ur_female),stack(as.data.frame(coredata(ur_female))))
names(ur_female_l)[1] &lt;- &quot;Date&quot;
names(ur_female_l)[2] &lt;- &quot;Value&quot;
names(ur_female_l)[3] &lt;- &quot;id&quot;

# Download: Inflation rate (D7OE in database MM23)
infl &lt;- pdfetch_ONS(&quot;D7OE&quot;,&quot;MM23&quot;)
names(infl) &lt;- &quot;CPI Inflation&quot;
periodicity(infl)</code></pre>
<pre><code>## Monthly periodicity from 1988-02-29 to 2024-08-31</code></pre>
<pre class="r"><code># keep all the data including 2022-jan
# this was the last observation available at the time this was written
# remove this line if you want to use updated data
infl &lt;- infl[&quot;/2022-12&quot;]  

infl_l &lt;- data.frame(index(infl),stack(as.data.frame(coredata(infl))))
names(infl_l)[1] &lt;- &quot;Date&quot;
names(infl_l)[2] &lt;- &quot;Value&quot;
names(infl_l)[3] &lt;- &quot;id&quot;</code></pre>
<p>Now we put both series into one dataframe by attaching the individual
dataframes. This can be done as we gave identical names to the three
columns in both dataframes.</p>
<pre class="r"><code>data_l &lt;- rbind(rGDP_l,ur_female_l)
data_l &lt;- rbind(data_l,infl_l)</code></pre>
<p>Now it may be more obvious why we called this the “long” format as
the data all appear in the same column. Different variables are
differentiated by the <code>id</code> variable.</p>
<p>Let’s produce some time series plots and ACF functions.</p>
<pre class="r"><code>p1 &lt;- ggplot(subset(data_l,id == &quot;Unemp Rate (female)&quot;),aes(x =Date, y=Value)) + 
  geom_line(colour = &quot;blue&quot;,size = 1.0) +
  ggtitle(&quot;Female Unemployment rate&quot;) +
  theme_bw()

p2 &lt;- ggplot(subset(data_l,id == &quot;CPI Inflation&quot;),aes(x =Date, y=Value)) + 
  geom_line(colour = &quot;blue&quot;,size = 1.0) +
  ggtitle(&quot;Inflation Rate&quot;) +
  theme_bw()

grid.arrange(p1, p2, nrow=1, ncol=2)</code></pre>
<p><img src="R_TS_Modelling_files/figure-html/unnamed-chunk-12-1.png" width="672" />
The <code>grid.arrange(p1, p2, nrow=1, ncol=2)</code> line in the code
helped us to set the two images next to each other. That is very nice
and often useful when you present data. This sort of effect can be
achieved in different ways. It is important to realise that usually you
can do the same think in R in different ways. When presenting the ACF
functions we present a different way.</p>
<p>If the data are in the long format it is pretty straightforward to
put two time-series into one graph (this makes sense if they exist on a
similar scale). We start by selecting the two series from our dataset we
want to show
(<code>subset(data_l,id %in% c("CPI Inflation","Unemp Rate (female)"))</code>),
before feeding this into the <code>ggplot</code> function using
<code>geom_line()</code>. What you do need to do is to tell the function
that the <code>id</code> variable splits the lines by colour
(<code>colour = id</code>).</p>
<pre class="r"><code>p2 &lt;- ggplot(subset(data_l,id %in% c(&quot;CPI Inflation&quot;,&quot;Unemp Rate (female)&quot;)),aes(x =Date, y=Value, colour = id)) + 
  geom_line(size = 1.0) +
  ggtitle(&quot;Various Time-Series&quot;) +
  theme_bw()
p2</code></pre>
<p><img src="R_TS_Modelling_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Now we return to the ACFs. We now use the
<code>par(mfrow=c(1,2))</code> line which tells R that the next plots
should be presented in a 1 by 2 frame.</p>
<pre class="r"><code>par(mfrow=c(1,2))

acf(ur_female,main = &quot;Unemployment Rate&quot;)
acf(infl, main = &quot;Inflation&quot;)</code></pre>
<p><img src="R_TS_Modelling_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>It will be interesting to see what happens when we difference data
series (or often their logs as this approximates growth rates).</p>
<pre class="r"><code>g_rGDP &lt;-diff(log(rGDP))
names(g_rGDP) &lt;- &quot;GDP, quarterly growth rate&quot;
g_ur_female &lt;-diff(log(ur_female))
names(g_ur_female) &lt;- &quot;Growth in Unemp Rate (female)&quot;</code></pre>
<pre class="r"><code>par(mfrow=c(1,2))

acf(g_rGDP,main = &quot;GDP, growth&quot;)
acf(g_ur_female, main = &quot;Unemployment Rate, growth&quot;)</code></pre>
<p>When you do this you will get an error message as the differencing
created a missing value in the <code>g_rGDP</code> and
<code>g_ur_female</code> series and the <code>acf</code> function really
dislikes missing values. Hence we need to tell it to ignore these.</p>
<pre class="r"><code>par(mfrow=c(2,2))
plot(g_rGDP)
plot(g_ur_female)
acf(g_rGDP,main = &quot;GDP, growth&quot;, na.action = na.pass)
acf(g_ur_female, main = &quot;Unemployment Rate, growth&quot;, na.action = na.pass)</code></pre>
<p><img src="R_TS_Modelling_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>As you can see from the above, the original series had a very slowly
decaying autocorrelation function which is a hallmark of non-stationary
data. The differenced series have a very quickly decaying ACF. This
illustrates that differencing can make a data series stationary.</p>
<p>There are statistical tests to test whether a series is stationary or
not (e.g. ADF tests), however, here we restrict ourselvs to eyeballing
the ACF function.</p>
</div>
<div id="run-a-simple-regression-model" class="section level1">
<h1>Run a simple regression model</h1>
<p>Let’s run a simple regression model with time series data.</p>
<p><span class="math display">\[ur_t = \alpha + \beta ~ rGDP_t +
u_t\]</span></p>
<p>As we have quarterly GDP series we will want to reduce the frequency
of the monthly unemployment data to quarterly. the <code>xts</code>
package which we have been using to deal with the dating aspect of our
data has a handy little function to achieve this.
<code>to.period()</code>.</p>
<pre class="r"><code>ur_female_q &lt;- to.period(ur_female,period=&quot;quarters&quot;)</code></pre>
<p>As a result we get four values for each quarter (start, end, high and
low). We shall associate the last monthly unemployment rate with a
particular quarter.</p>
<pre class="r"><code>ur_female_q &lt;- ur_female_q$ur_female.Close</code></pre>
<p>We now have two quarterly series <code>rGDP</code> and
<code>ur_female_q</code>. We shall merge them into the same
dataframe.</p>
<pre class="r"><code>reg_data &lt;- merge(rGDP, ur_female_q)
tail(reg_data,10)</code></pre>
<pre><code>##            real.GDP ur_female.Close
## 2020-09-30   562648             4.8
## 2020-12-31   570338             5.1
## 2021-03-31   564411             4.9
## 2021-06-30   605353             4.5
## 2021-09-30   615459             4.1
## 2021-12-31   624592             3.9
## 2022-03-31   629149             3.9
## 2022-06-30   631258             3.7
## 2022-09-30   631977             3.9
## 2022-12-31   634044             3.9</code></pre>
<p>By looking at the last 10 observations we can see that automatically
the dates have been matched. This is super convenient. This is now a
dataset in a wide format, in which each variable occupies its own
columns. This is the format in which you need the data to run
regressions. As you saw above, to plot data with the <code>ggplot</code>
function requires a wide format. You therefore often have to maintain
data in two formats.</p>
<p>We can now feed these data into the <code>lm</code> function and
display the results using the stargazer package (using
heteroskedasticity and autocorrelation robust standard errors,
<code>stargazer_HAC</code>).</p>
<pre class="r"><code>mod1 &lt;- lm(ur_female.Close~real.GDP,data = reg_data)
stargazer_HAC(mod1)</code></pre>
<pre><code>## 
## =============================================================
##                                Dependent variable:           
##                     -----------------------------------------
##                                  ur_female.Close             
## -------------------------------------------------------------
## real.GDP                           -0.00001***               
##                                     (0.00000)                
##                                                              
## Constant                            9.700***                 
##                                      (0.650)                 
##                                                              
## -------------------------------------------------------------
## Observations                           123                   
## R2                                    0.270                  
## Adjusted R2                           0.270                  
## Residual Std. Error             1.100 (df = 121)             
## F Statistic                  46.000*** (df = 1; 121)         
## =============================================================
## Note:                             *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
##                     Newey-West standard errors in parenthesis</code></pre>
<p>This seems to suggest that higher GDP, significantly, reduces the
unemployment rate.</p>
<p>Let’s have a look at the residuals.</p>
<pre class="r"><code>par(mfrow=c(1,2))
plot(mod1$residuals, type = &quot;l&quot;, main = &quot;mod1 - Residuals&quot;)
acf(mod1$residuals)</code></pre>
<p><img src="R_TS_Modelling_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>We can see that there is a significant amount of autocorrelation in
the residuals. We can apply the Breusch-Godfrey hypothesis test
(<code>bgtest</code>). The null hypothesis is that there is no
autocorrelation.</p>
<pre class="r"><code>bgtest(mod1,order=4)</code></pre>
<pre><code>## 
##  Breusch-Godfrey test for serial correlation of order up to 4
## 
## data:  mod1
## LM test = 117, df = 4, p-value &lt;2e-16</code></pre>
<p>The p-value is virtually 0 suggesting that there is staistically
significant evidence that we should reject the null hypothesis of no
autocorrelation. What is the consequence?</p>
<p>when looking at the data earlier, we realised that GDP and the female
unemployment rate were nonstationary time-series. As you will have
learned in your econometrics class, you should (in general) not take any
regression results seriously if they involve nonstationary series, and
in particular if the regressions from this regression are nonstationary
themselves (as are the ones here).</p>
<p>Towards the end of this page you will find a demonstration of this
point.</p>
</div>
<div id="run-a-simple-regression-model---but-better"
class="section level1">
<h1>Run a simple regression model - but better</h1>
<p>Let’s re-run the simple regression model but this time with
differenced (and stationary) time series data.</p>
<p><span class="math display">\[\Delta ur_t = \alpha + \beta ~
\Delta  rGDP_t + u_t\]</span></p>
<p>As we will be modelling the differenced logs of the GDP and
unemployment rate it is most convenient to create these variables
explicitly in the data frame, otherwise we will have to deal with very
long variable names.</p>
<pre class="r"><code># we multiply by 100 to express in percentage points, i.e. 0.5 is 0.5% or 0.005
reg_data$d_lgdp &lt;- 100*diff(log(reg_data$real.GDP))
reg_data$d_lur &lt;- 100*diff(log(reg_data$ur_female.Close)) </code></pre>
<p>We can now feed these data into the <code>lm</code> function.</p>
<pre class="r"><code>mod4 &lt;- lm(d_lur~d_lgdp,data = reg_data)
stargazer_HAC(mod4)</code></pre>
<pre><code>## 
## =============================================================
##                                Dependent variable:           
##                     -----------------------------------------
##                                       d_lur                  
## -------------------------------------------------------------
## d_lgdp                               -0.210                  
##                                      (0.240)                 
##                                                              
## Constant                             -0.450                  
##                                      (0.430)                 
##                                                              
## -------------------------------------------------------------
## Observations                           122                   
## R2                                    0.019                  
## Adjusted R2                           0.011                  
## Residual Std. Error             4.100 (df = 120)             
## F Statistic                    2.300 (df = 1; 120)           
## =============================================================
## Note:                             *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
##                     Newey-West standard errors in parenthesis</code></pre>
<p>There is no more statistically significant relationship between GDP
growth and the growth in the unemployment rate.</p>
<p>Let’s have a look at the residuals.</p>
<pre class="r"><code>par(mfrow=c(1,2))
plot(mod4$residuals, type = &quot;l&quot;, main = &quot;mod4 - Residuals&quot;)
acf(mod4$residuals)</code></pre>
<p><img src="R_TS_Modelling_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>We can see that, at lag 2, there is a small amount of autocorrelation
in the residuals. We can again apply the hypothesis test the
Breusch-Godfrey test (<code>bgtest</code>). The null hypothesis is that
there is no autocorrelation.</p>
<pre class="r"><code>bgtest(mod4,order=4)</code></pre>
<pre><code>## 
##  Breusch-Godfrey test for serial correlation of order up to 4
## 
## data:  mod4
## LM test = 14, df = 4, p-value = 0.007</code></pre>
<p>The p-value of 0.00085 suggests that there is still evidence that we
should reject the null hypothesis of no autocorrelation. What is the
consequence? Fortunately, here, despite the existence of autocorrelation
in residuals they still look stationary.</p>
<p>The HAC standard errors above will have accommodated this
autocorrelation.</p>
</div>
<div id="adl-models" class="section level1">
<h1>ADL Models</h1>
<p>When estimating regresison models with time-series data we will often
consider the inclusion of lagged variables. As the data are saved as
time series data in the <code>xts</code> format), it is very
straightforward to create lagged variables and therefore to estimate a
model like:</p>
<p><span class="math display">\[\Delta ur_t = \alpha + \beta_0 ~
\Delta  rGDP_t + \beta_1 ~ \Delta  rGDP_{t-1} + \beta_2 ~
\Delta  rGDP_{t-2} + \gamma_1 ~ \Delta  ur_{t-1} + \gamma_2 ~
\Delta  ur_{t-2} + u_t\]</span></p>
<p>We don’t actually have to create the lagged variables in our
<code>reg_data</code> dataframe. We merely create the lags in the
regression call (e.g. <code>lag(d_lgdp,2)</code> is <span
class="math inline">\(\Delta  rGDP_{t-2}\)</span>).</p>
<pre class="r"><code>mod5 &lt;- lm(d_lur~lag(d_lur,1)+lag(d_lur,2)+d_lgdp+lag(d_lgdp,1)+lag(d_lgdp,2),data = reg_data)
stargazer_HAC(mod5)</code></pre>
<pre><code>## 
## ====================================================================================
##                                           Dependent variable:                       
##                     ----------------------------------------------------------------
##                                                  d_lur                              
## ------------------------------------------------------------------------------------
## lag(d_lur, 1)                                   1.000***                            
##                                                 (0.000)                             
##                                                                                     
## lag(d_lur, 2)                                                                       
##                                                                                     
##                                                                                     
## d_lgdp                                           -0.000                             
##                                                 (0.000)                             
##                                                                                     
## lag(d_lgdp, 1)                                                                      
##                                                                                     
##                                                                                     
## lag(d_lgdp, 2)                                                                      
##                                                                                     
##                                                                                     
## Constant                                         0.000                              
##                                                 (0.000)                             
##                                                                                     
## ------------------------------------------------------------------------------------
## Observations                                      122                               
## R2                                               1.000                              
## Adjusted R2                                      1.000                              
## Residual Std. Error                         0.000 (df = 119)                        
## F Statistic         530,859,669,020,599,095,386,000,440,244,868.000*** (df = 2; 119)
## ====================================================================================
## Note:                                                    *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
##                                            Newey-West standard errors in parenthesis</code></pre>
<pre class="r"><code>par(mfrow=c(1,2))
plot(mod5$residuals, type = &quot;l&quot;,main = &quot;mod5 - Residuals&quot;)
acf(mod5$residuals)</code></pre>
<p><img src="R_TS_Modelling_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>Now the coefficient to the real GDP growth rate at time <span
class="math inline">\(t\)</span> remains statistically insignificant,
but only marginally. Most important appears to be the unemployment rate
from two quarters prior (t-2), <code>lag(d_lur,2)</code>.</p>
<pre class="r"><code>bgtest(mod5,order=4)</code></pre>
<pre><code>## 
##  Breusch-Godfrey test for serial correlation of order up to 4
## 
## data:  mod5
## LM test = 0.7, df = 4, p-value = 1</code></pre>
<p>Now we remove the contemporaneous GDP growth rate as this will be
important if you wanted to produce forecasts from the unemployment rate
from this model.</p>
<pre class="r"><code>mod6 &lt;- lm(d_lur~lag(d_lur,1)+lag(d_lur,2)+lag(d_lgdp,1)+lag(d_lgdp,2),data = reg_data)
stargazer_HAC(mod6)</code></pre>
<pre><code>## 
## ====================================================================================
##                                           Dependent variable:                       
##                     ----------------------------------------------------------------
##                                                  d_lur                              
## ------------------------------------------------------------------------------------
## lag(d_lur, 1)                                   1.000***                            
##                                                 (0.000)                             
##                                                                                     
## lag(d_lur, 2)                                                                       
##                                                                                     
##                                                                                     
## lag(d_lgdp, 1)                                   -0.000                             
##                                                 (0.000)                             
##                                                                                     
## lag(d_lgdp, 2)                                                                      
##                                                                                     
##                                                                                     
## Constant                                         0.000                              
##                                                 (0.000)                             
##                                                                                     
## ------------------------------------------------------------------------------------
## Observations                                      122                               
## R2                                               1.000                              
## Adjusted R2                                      1.000                              
## Residual Std. Error                         0.000 (df = 119)                        
## F Statistic         530,859,669,020,599,095,386,000,440,244,868.000*** (df = 2; 119)
## ====================================================================================
## Note:                                                    *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
##                                            Newey-West standard errors in parenthesis</code></pre>
<pre class="r"><code>par(mfrow=c(1,2))
plot(mod6$residuals, type = &quot;l&quot;,main = &quot;mod6 - Residuals&quot;)
acf(mod6$residuals)</code></pre>
<p><img src="R_TS_Modelling_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<pre class="r"><code>bgtest(mod6,order=4)</code></pre>
<pre><code>## 
##  Breusch-Godfrey test for serial correlation of order up to 4
## 
## data:  mod6
## LM test = 0.7, df = 4, p-value = 1</code></pre>
</div>
<div id="autoregressive-models" class="section level1">
<h1>Autoregressive Models</h1>
<p>The above model can be further simplified by excluding the GDP growth
variables altogether. Such models are then called autoregressive
models.</p>
<pre class="r"><code>mod7 &lt;- lm(d_lur~lag(d_lur,1)+lag(d_lur,2),data = reg_data)
stargazer_HAC(mod7)</code></pre>
<pre><code>## 
## ======================================================================================
##                                            Dependent variable:                        
##                     ------------------------------------------------------------------
##                                                   d_lur                               
## --------------------------------------------------------------------------------------
## lag(d_lur, 1)                                    1.000***                             
##                                                  (0.000)                              
##                                                                                       
## lag(d_lur, 2)                                                                         
##                                                                                       
##                                                                                       
## Constant                                          0.000                               
##                                                  (0.000)                              
##                                                                                       
## --------------------------------------------------------------------------------------
## Observations                                       122                                
## R2                                                1.000                               
## Adjusted R2                                       1.000                               
## Residual Std. Error                          0.000 (df = 120)                         
## F Statistic         1,070,617,863,298,088,691,546,248,426,880,480.000*** (df = 1; 120)
## ======================================================================================
## Note:                                                      *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
##                                              Newey-West standard errors in parenthesis</code></pre>
<pre class="r"><code>par(mfrow=c(1,2))
plot(mod7$residuals, type = &quot;l&quot;,main = &quot;mod7 - Residuals&quot;)
acf(mod7$residuals)</code></pre>
<p><img src="R_TS_Modelling_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<pre class="r"><code>bgtest(mod7,order=4)</code></pre>
<pre><code>## 
##  Breusch-Godfrey test for serial correlation of order up to 4
## 
## data:  mod7
## LM test = 0.7, df = 4, p-value = 1</code></pre>
<p>Let’s look at all these models together in one table.</p>
<pre class="r"><code>stargazer_HAC(mod4,mod5,mod6,mod7,type_out = &quot;text&quot;, omit.stat = &quot;f&quot;)</code></pre>
<pre><code>## 
## =======================================================================================
##                                             Dependent variable:                        
##                     -------------------------------------------------------------------
##                                                    d_lur                               
##                           (1)              (2)              (3)              (4)       
## ---------------------------------------------------------------------------------------
## lag(d_lur, 1)                            1.000***         1.000***         1.000***    
##                                          (0.000)          (0.000)          (0.000)     
##                                                                                        
## lag(d_lur, 2)                                                                          
##                                                                                        
##                                                                                        
## d_lgdp                   -0.210           -0.000                                       
##                         (0.240)          (0.000)                                       
##                                                                                        
## lag(d_lgdp, 1)                                             -0.000                      
##                                                           (0.000)                      
##                                                                                        
## lag(d_lgdp, 2)                                                                         
##                                                                                        
##                                                                                        
## Constant                 -0.450           0.000            0.000            0.000      
##                         (0.430)          (0.000)          (0.000)          (0.000)     
##                                                                                        
## ---------------------------------------------------------------------------------------
## Observations              122              122              122              122       
## R2                       0.019            1.000            1.000            1.000      
## Adjusted R2              0.011            1.000            1.000            1.000      
## Residual Std. Error 4.100 (df = 120) 0.000 (df = 119) 0.000 (df = 119) 0.000 (df = 120)
## =======================================================================================
## Note:                                                       *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
##                                               Newey-West standard errors in parenthesis</code></pre>
</div>
<div id="information-criteria" class="section level1">
<h1>Information criteria</h1>
<p>Let’s say we wanted to figure out whether it would be better to
include more lags. In addition to models <code>mod6</code> (ADL) and
<code>mod7</code> (AR), we shall estimate the equivalent models with 4
lags. In order to then decide which model is best we look at an
information criteria. This recognises that the inclusion of additional
variables (lags) will improve the fit, but it will also reduce the
precision with which the parameters are estimated. That can be
detrimental especially for forecasting. Information criteria take this
trade-off into account and offer a way to chose the best model.</p>
<pre class="r"><code>mod6_4 &lt;- lm(d_lur~lag(d_lur,1)+lag(d_lur,2)+lag(d_lur,3)+lag(d_lur,4)+
               lag(d_lgdp,1)+lag(d_lgdp,2)+lag(d_lgdp,3)+lag(d_lgdp,4),data = reg_data)
mod7_4 &lt;- lm(d_lur~lag(d_lur,1)+lag(d_lur,2)+lag(d_lur,3)+lag(d_lur,4),data = reg_data)

stargazer_HAC(mod6,mod7,mod6_4,mod7_4,type_out = &quot;text&quot;, omit.stat = &quot;f&quot;)</code></pre>
<pre><code>## 
## =======================================================================================
##                                             Dependent variable:                        
##                     -------------------------------------------------------------------
##                                                    d_lur                               
##                           (1)              (2)              (3)              (4)       
## ---------------------------------------------------------------------------------------
## lag(d_lur, 1)           1.000***         1.000***         1.000***         1.000***    
##                         (0.000)          (0.000)          (0.000)          (0.000)     
##                                                                                        
## lag(d_lur, 2)                                                                          
##                                                                                        
##                                                                                        
## lag(d_lur, 3)                                                                          
##                                                                                        
##                                                                                        
## lag(d_lur, 4)                                                                          
##                                                                                        
##                                                                                        
## lag(d_lgdp, 1)           -0.000                            -0.000                      
##                         (0.000)                           (0.000)                      
##                                                                                        
## lag(d_lgdp, 2)                                                                         
##                                                                                        
##                                                                                        
## lag(d_lgdp, 3)                                                                         
##                                                                                        
##                                                                                        
## lag(d_lgdp, 4)                                                                         
##                                                                                        
##                                                                                        
## Constant                 0.000            0.000            0.000            0.000      
##                         (0.000)          (0.000)          (0.000)          (0.000)     
##                                                                                        
## ---------------------------------------------------------------------------------------
## Observations              122              122              122              122       
## R2                       1.000            1.000            1.000            1.000      
## Adjusted R2              1.000            1.000            1.000            1.000      
## Residual Std. Error 0.000 (df = 119) 0.000 (df = 120) 0.000 (df = 119) 0.000 (df = 120)
## =======================================================================================
## Note:                                                       *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
##                                               Newey-West standard errors in parenthesis</code></pre>
<pre class="r"><code>AIC(mod6, mod7, mod6_4,mod7_4)</code></pre>
<pre><code>##        df   AIC
## mod6    4 -7995
## mod7    3 -7997
## mod6_4  4 -7995
## mod7_4  3 -7997</code></pre>
<p>We chose the model with the smallest value for the information
criterion and on this occasion this is the ADL model with 4 lags
(despite lags 3 and 4 not being statistically significant).</p>
</div>
<div id="summary" class="section level1">
<h1>Summary</h1>
<p>In this page you learned how to deal with time-series data, visualise
these in plots, calculate autocorrelation functions, difference serious
and use them in simple regression models. As we went along we pointed
out that running regresisons with nonstationary series may not be a good
idea. In the following addendum we attempt to demonstrates why that is
the case.</p>
</div>
<div id="addendum---spurious-correlations-and-regressions"
class="section level1">
<h1>Addendum - Spurious correlations and regressions</h1>
<p>Let’s get some datasets from EUROSTAT. The data are saved here: <a
href="https://datasquad.github.io/ECLR/blob/EUROSTATtimeseries.csv">EUROSTATtimeseries.csv</a>.
Save this file into your working directory. The dataset contains the
following four variables</p>
<ul>
<li>% of agricultural area Total fully converted and under conversion to
organic farming in Germany, “sdg_02_40”</li>
<li>Thousands of passengers travelling to and from Norway by boat,
“mar_pa_aa”</li>
<li>Population with tertiary education (%) in Italy, “edat_lfse_03”</li>
<li>Energy consumption, in Poland “Ene.Cons.PO”</li>
</ul>
<p>The data are annual data from 2000 to 2021, 22 obs. YOu may wonder
why these four series were used, they seem to be totally unrelated. And
that is exactly the point. There is really no way that you could
sensibly argue that there is any economic relationship between any of
these four series.</p>
<pre class="r"><code>data_sr &lt;- read_csv(&quot;EUROSTATtimeseries.csv&quot;)</code></pre>
<p>These data are not yet in the <code>xts</code> data format. We can
convert them into that time-series format as follows:</p>
<pre class="r"><code>dates &lt;- seq(as.Date(&quot;2000-12-31&quot;),length=22,by=&quot;years&quot;)
data_sr &lt;- xts(x=data_sr, order.by = dates)</code></pre>
<p>We told you earlier that there are different ways to arrange several
plots in a grid. Below I present yet another (<code>layout</code> - this
is possibly the most powerful of the three as you can determine how big
each graph should be)! Don’t say that this is annoying! I am merely
ramming home the message that the same thing can be done in different
ways and anyways, you will not be remembering how to do all these
things. When you want to do it you will be searching for “R arrange
plots in grid” or something similar. Then you will hit on any of these
methods and that is what you will adjust.</p>
<pre class="r"><code>layout(matrix(c(1,2,3,4), 2, 2, byrow = TRUE),
   widths=c(1,1), heights=c(1,1))
plot.zoo(data_sr$Boat.Passengers.NO, ylab=&quot;&quot;, xlab = &quot;&quot;, main = &quot;Sea Passengers\n NOR&quot;)
plot.zoo(data_sr$Organic.Farming.GE, ylab=&quot;&quot;, xlab = &quot;&quot;, main = &quot;Organic Farming\n GER&quot;) 
plot.zoo(data_sr$Tert.Educ.IT, ylab=&quot;&quot;, xlab = &quot;&quot;, main = &quot;Tertiary Education\n ITA&quot;)
plot.zoo(data_sr$Ene.Cons.PO, ylab=&quot;&quot;, xlab = &quot;&quot;, main = &quot;Energy Consumption\n POL&quot;)</code></pre>
<p><img src="R_TS_Modelling_files/figure-html/unnamed-chunk-38-1.png" width="672" />
In the above graphing commands I used <code>plot.zoo</code> and not
<code>ggplot</code> or the standard <code>plot</code>. You could have
used <code>ggplot</code> after bringing the data into long format. You
could have used the standard <code>plot</code> function. It actually
does recognise that the data are time-series data and then automatically
adds all sorts of formatting to the graphs (try by replacing
<code>plot.zoo</code> with <code>plot</code> in the above) which is
rather annoying. <code>plot.zoo</code> is a specialised plotting
function for time-series data which allows some manual finessing.</p>
<p>As you can see from the time series plots, all ,but for the Norwegian
series on sea passengers, are trending data and hence nonstationary. Let
us run a regression between two of the clearly nonstationary series:</p>
<pre class="r"><code>mod_sr &lt;- lm(Ene.Cons.PO~Organic.Farming.GE, data = data_sr)
stargazer_HAC(mod_sr)</code></pre>
<pre><code>## 
## =============================================================
##                                Dependent variable:           
##                     -----------------------------------------
##                                    Ene.Cons.PO               
## -------------------------------------------------------------
## Organic.Farming.GE                  2.900***                 
##                                      (0.480)                 
##                                                              
## Constant                            76.000***                
##                                      (2.500)                 
##                                                              
## -------------------------------------------------------------
## Observations                           22                    
## R2                                    0.710                  
## Adjusted R2                           0.690                  
## Residual Std. Error              3.200 (df = 20)             
## F Statistic                  49.000*** (df = 1; 20)          
## =============================================================
## Note:                             *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
##                     Newey-West standard errors in parenthesis</code></pre>
<p>On the face of it, there seems to be a clear, statistically
significant relationship between these series. This is a spurious
regression. One way how you can unmask the spuriousness, if both series
are trending is to include a time trend</p>
<pre class="r"><code>mod_sr2 &lt;- lm(Ene.Cons.PO~Organic.Farming.GE+index(data_sr), data = data_sr)
stargazer_HAC(mod_sr2,type_out = &quot;text&quot;, omit.stat = &quot;f&quot;)</code></pre>
<pre><code>## 
## =============================================================
##                                Dependent variable:           
##                     -----------------------------------------
##                                    Ene.Cons.PO               
## -------------------------------------------------------------
## Organic.Farming.GE                    1.100                  
##                                      (1.900)                 
##                                                              
## index(data_sr)                        0.001                  
##                                      (0.001)                 
##                                                              
## Constant                            67.000***                
##                                     (10.000)                 
##                                                              
## -------------------------------------------------------------
## Observations                           22                    
## R2                                    0.740                  
## Adjusted R2                           0.710                  
## Residual Std. Error              3.100 (df = 19)             
## =============================================================
## Note:                             *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
##                     Newey-West standard errors in parenthesis</code></pre>
<p>Now we can see that the obvious relationship between the two
variables has disappeared (as it should be).</p>
<p>We may also want to look at running a model in the differences of
variables rather than the levels.</p>
<pre class="r"><code>mod_sr3 &lt;- lm(diff(Ene.Cons.PO)~diff(Organic.Farming.GE), data = data_sr)
stargazer_HAC(mod_sr,mod_sr2,mod_sr3,type_out = &quot;text&quot;, omit.stat = &quot;f&quot;)</code></pre>
<pre><code>## 
## ==========================================================================
##                                         Dependent variable:               
##                          -------------------------------------------------
##                                    Ene.Cons.PO           diff(Ene.Cons.PO)
##                                (1)             (2)              (3)       
## --------------------------------------------------------------------------
## Organic.Farming.GE          2.900***          1.100                       
##                              (0.480)         (1.900)                      
##                                                                           
## index(data_sr)                                0.001                       
##                                              (0.001)                      
##                                                                           
## diff(Organic.Farming.GE)                                      -1.200      
##                                                               (1.800)     
##                                                                           
## Constant                    76.000***       67.000***          1.300      
##                              (2.500)        (10.000)          (1.100)     
##                                                                           
## --------------------------------------------------------------------------
## Observations                   22              22               21        
## R2                            0.710           0.740            0.020      
## Adjusted R2                   0.690           0.710           -0.031      
## Residual Std. Error      3.200 (df = 20) 3.100 (df = 19)  3.500 (df = 19) 
## ==========================================================================
## Note:                                          *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
##                                  Newey-West standard errors in parenthesis</code></pre>
<p>You can see that both, including a time trend or estimating the model
in growth rates, eliminated the spurious correlation between the two
variables.</p>
<p>You can replicate this finding for any combination of nonstationary
variables.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
