<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>First Steps in R</title>

<script src="site_libs/header-attrs-2.21/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">HOME</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="examples.html">Examples</a>
</li>
<li>
  <a href="Datasets.html">Datasets</a>
</li>
<li>
  <a href="resources.html">Resources</a>
</li>
<li>
  <a href="Author.html">Author</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">First Steps in R</h1>

</div>


<div id="learning-outcomes" class="section level1">
<h1>Learning Outcomes</h1>
<p>This document is for you to experience some very basic functionality
in R/RStudio.</p>
<p>In particular this is for you</p>
<ul>
<li>to explore the RStudio interface</li>
<li>to learn how to search for help</li>
<li>to not be scared by error messages</li>
<li>to know how to load libraries</li>
<li>to upload a datafile</li>
<li>to explore the contents of this datafile</li>
<li>to learn what functions do</li>
<li>to learn about data types</li>
<li>to undertake some basic data manipulation</li>
</ul>
<p>This Data Lab assumes that you have R and RStudio installed on your
computer. Alternatively you can get yourself an RStudio/Posit Cloud
account (<a href="https://posit.cloud/"
class="uri">https://posit.cloud/</a>). The free account is sufficient to
get started. But in the end you should attempt to have RStudio up and
running on your computer.</p>
</div>
<div id="prepare-your-workspace" class="section level1">
<h1>Prepare your Workspace</h1>
<p>Before you start you should create a space (i.e. a folder) on your
computer from where you are planning to do all your R work. Make sure
you understand where that folder is and that you know the path to that
folder.</p>
<p>Let’s say you named your folder <code>Rwork</code> on your C drive,
then the path to your folder will be <code>C:\Rwork</code>.</p>
<p>For this computer lab we are using the datafile <a
href="https://github.com/datasquad/ECLR/blob/gh-pages/data/STATS19_GM_AccData.csv">STATS19_GM_AccData.csv</a>.
You should download this datafile into the folder you just created and
want to work from. It will also be useful to have the <a
href="https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/995422/stats19.pdf">Data
Dictionary</a> ready.</p>
</div>
<div id="exploring-rstudio-and-searching" class="section level1">
<h1>Exploring RStudio and searching</h1>
<p>RStudio is a software which makes working with the actual statistical
software R easier. In fact, once you followed the installation advice
and have R and RStudio installed, you will never really have to worry
about R anymore. Just start RStudio.</p>
<p>When you load RStudio for the first time you should see something
like this.</p>
<div class="float">
<img src="images/RStudio_image0.png"
alt="RStudio when loading for the first time" />
<div class="figcaption">RStudio when loading for the first time</div>
</div>
<p>There are two important areas on that screen, the Console and the
Environment. The Console is something like your main computational area.
In there you can see some information but at the end an “&gt;”. This
indicates that RStudio is standing ready to do whatever you want it to
do.</p>
<p>Say you want to calculate 3+4 … yes, trivial but let’s start small.
Type 3+4 into the console (behind the “&gt;” sign) and press enter. Yes
you should see the correct result.</p>
<pre class="r"><code>3+4</code></pre>
<pre><code>## [1] 7</code></pre>
<p>That was easy, let’s see whether you can get R to calculate <span
class="math inline">\(13^2\)</span>, <span
class="math inline">\(\sqrt{7569}\)</span>, <span
class="math inline">\(e^{5}\)</span> and <span
class="math inline">\(ln(5)\)</span>. The first you achieve as
follows:</p>
<pre class="r"><code>13^2</code></pre>
<pre><code>## [1] 169</code></pre>
<p>What about the others. Well, at this stage we will introduce you to
two of the most inportant programming techniques there are:</p>
<ol style="list-style-type: decimal">
<li>Just try it. Do you have a hunch how to do it? Test it. I am yet to
hear that someone broke their computer by entering an incorrect command
in RStudio.</li>
<li>searching on the Web (say in Google, Bing, Baidu or DuckDuckGo)! For
instance if you want to know how to calculate a square root in R you may
want to search for “how to calculate a square root in R” and you should
find the appropriate advice. Practice your search technique to calculate
the above solutions. Check against your calculator.</li>
</ol>
</div>
<div id="functions" class="section level1">
<h1>Functions</h1>
<p>Functions are important building blocks of any programming language.
You just used your first function. Hopefully you found out that the way
to calculate <span class="math inline">\(\sqrt{7569}\)</span> was to
type</p>
<pre class="r"><code>sqrt(7569)</code></pre>
<pre><code>## [1] 87</code></pre>
<p>Giving you the result 87. What you used here is a function, namely
the <code>sqrt</code> function which some clever programmer wrote in
order to calculate a square root. The anatomy of a function is
<code>function_name(input)</code>. Think of a function as a drink
machine.</p>
<div class="float">
<img src="images/DrinkMachine.png" style="width:50.0%"
alt="A drink machine is a function." />
<div class="figcaption">A drink machine is a function.</div>
</div>
<p>Most functions require some input. Our function, the
<code>sqrt</code> function needs a number of which to take the square
root. The output in our example, 87, is then returned. In our case it is
returned to be printed in the Console window.</p>
</div>
<div id="creating-variables" class="section level1">
<h1>Creating variables</h1>
<p>So far you have learned that R can be used as a glorified calculator.
Let’s start to explore why R is way more powerful that that. You can
save the results of as many calculations as you want and you can easily
reuse the results of some calculations in later calculations.</p>
<p>Type “a&lt;-12/4” into the console (without the quotation marks) and
press enter</p>
<pre class="r"><code>a &lt;- 12/4</code></pre>
<p>You will see that in the console the correct result does not show,
but in the Environment pane of your RStudio window you should now see an
entry</p>
<div class="float">
<img src="images/RStudio_Env.png"
alt="RStudio Environment saves variables" />
<div class="figcaption">RStudio Environment saves variables</div>
</div>
<p>What did the command “a&lt;-12/4” actually do? In words: “Calculate
12/4 and assign (&lt;-) the result to a variable called
<code>a</code>.”</p>
<p>With that in mind implement the following: “Calculate 11*11 and
assign (&lt;-) the result to a variable called <code>A</code>.”</p>
<p>You should now see two variables in your Environment pane. Let’s add
another: “Calculate the square root of 64 and assign (&lt;-) the result
to a variable called <code>b</code>.”</p>
<p>Note that we used the <code>sqrt</code> function again, but this time
the output was not send to be printed in the Console, but instead it was
send to the new variable <code>b</code>. If you have done everything
right your Environment panel should now look as follows</p>
<div class="float">
<img src="RStudio_Env2.png" alt="RStudio Environment saves variables" />
<div class="figcaption">RStudio Environment saves variables</div>
</div>
<p>Note that <code>a</code> and <code>A</code> are different variables,
so R is case-sensitive! All the variables listed in the Environment can
be re-used for further calculations. For example:</p>
<pre class="r"><code>d &lt;- A - a + 2*b</code></pre>
<p>Let’s perform another calculation in which we use the result of the
last calculation:</p>
<pre class="r"><code>e &lt;- D - 3*a</code></pre>
<pre><code>## Error in D - 3 * a: non-numeric argument to binary operator</code></pre>
<p>You will see R throwing an error message at you: “Error in D - 3 * a
: non-numeric argument to binary operator”. Ehmmm … what does this mean?
Actually not a lot. In the first instance this tells you that something
went wrong in that command. Can you see what the problem is? Remember R
is trying to perform the calculation to the right of <code>&lt;-</code>
and then assign this to a new variable <code>e</code>. Does it have all
the info on the right hand side? Check your list of variables in the
Environment panel. Recall that R is case sensitive.</p>
<p>An important lesson with respect to error messages</p>
<ul>
<li>You will see them ALL THE TIME, and that is fine</li>
<li>You cannot break the computer with any errors in R, so don’t worry,
just try.</li>
<li>Re-read what you typed, is it actually what you wanted to do.</li>
<li>Read the error message. Sometimes it will give you a clue as to what
the problem is … unfortunately not here!</li>
</ul>
<hr />
<p>So, we have done a bit of work so far. Let’s take a short break.
Please close RStudio and click “Don’t Save” when you get the message in
the next image.</p>
<div class="float">
<img src="images/RStudio_SaveWorkspace.png"
alt="RStudio Environment saves variables" />
<div class="figcaption">RStudio Environment saves variables</div>
</div>
<p>Get up, stretch your legs and get yourself a glass to drink. Then
come back and open RStudio again so that we can continue our work.</p>
<p>As you open you should get exactly the same initial layout as before
… What value did <code>e</code> have again???? (125 if you managed to
correct the above error) Where are our calculations??? Unless you worked
in a script file, all your work is gone now. The next section is to
teach you the right workflow such that this does not happen with your
important work.</p>
</div>
<div id="preparing-your-script-file-and-libraries"
class="section level1">
<h1>Preparing your script file and libraries</h1>
<p>For all significant work you want to make sure that you save the work
you have done, such that you do not have to re-type things which you did
yesterday … or just before I asked you to get a glass of water. The way
to ensure that is to save all your work in a script file. A script file
is basically a text file which saves all your commands (and comments -
see below) and from where RStudio can easily execute these commands.</p>
<p>Let’s create a script file. Via the RStudio menu (FILE - NEW FILE - R
SCRIPT) open a new script file and safe it in the folder from which you
want to work (see above).</p>
<p>Start by creating a comment line at the top of that file which may
say something like</p>
<pre class="r"><code># File for first SE Data Lab
# October 2023
# exciting!!!</code></pre>
<blockquote>
<p>Note: Adding comments to your code is absolutely vital if you want to
understand tomorrow what you did today. I am not joking, adding comments
to explain to your future self what you are doing is absolutly critical.
Everything which follows the <code>#</code> sign is a comment and is
effectively ignored by R. It is written not for R but for your future
self!</p>
</blockquote>
<p>If not mentioned otherwise all the following code should be added to
that script file and executed from there. Save that file and make sure
you know where you save it as, next week, you may want to continue to
work on this.</p>
<p>Next, you should ensure that you set the working directory to the
directory where your scriptfile and datafile is in. If your folder was
<code>C:\Rwork</code> then the command below should read
<code>setwd("C:/Rwork")</code>. Note that all backward slashes
(<code>\</code>) have to be replaced by forward slashes
(<code>/</code>). Don’t ask why, just accept ;-).</p>
<pre class="r"><code>setwd(&quot;XXXX:/XXXX&quot;)   # replace the XXXX with your drive and path</code></pre>
<blockquote>
<p>Note; If you are having trouble finding the location of your script
file, or how to formally write it down, this is a trick. In the menu to
RStudio click on teh following: “Session” - “Set Working Directory” -
“To Source File Location”. RStudio will find the path to your script and
will execute the command. You can then copy the command from the console
into your script such that you have it saved for next time.</p>
</blockquote>
<p>Load the libraries which we want to use.</p>
<pre class="r"><code>library(tidyverse)    # for almost all data handling tasks
library(ggplot2)      # to produce nice graphiscs</code></pre>
<blockquote>
<p>Note: Libraries are collections of functions which add great
functionality. They are not included in the base R installation and
hence need to be added to your computer (see installation advice for
packages below - this only has to be done once on each computer).
However, even once they are installed on you need to make this new
functionality available to your code. This is what the
<code>library</code> functions do. This has to be done at the beginning
of every script file in which you want to use the respective
functionality.</p>
</blockquote>
<p>By just typing these commands into the script file nothing is
actually happening. If you want R to execute any of the commands in your
script file you have to do one of the following:</p>
<div class="float">
<img src="images/RStudio_image1.png" alt="RStudio executing code" />
<div class="figcaption">RStudio executing code</div>
</div>
<ol style="list-style-type: decimal">
<li>Press the “Source” button, in which case R will execute all commands
in the script file</li>
<li>Press the “Run” button, in which case R will run the command in
which the curser currently is</li>
<li>Press the “CTRL”+“ENTER” on the keyboard (COMMAND + ENTER on a mac),
in which case R will run the command in which the curser currently
is</li>
<li>Highlight several lines and press “CTRL”+“ENTER” on the keyboard
(COMMAND + ENTER on a mac), in which case R will run the commands in the
highlighted lines</li>
</ol>
<p>If RStudio tells you that one or more of these libraries are not
installed then install these (not any others) on the machine you are
working from. For instance, if <code>ggplot2</code> was not installed
you would receive an error message like “Error in library(ggplot2) :
there is no package called ‘ggplot2’”, and in that case you should
run:</p>
<pre class="r"><code>install.packages(&quot;ggplot2&quot;)</code></pre>
<p>You can run this straight from the command/console or you could
instead install the package via the packages tab on the right hand side.
You will need to do this only once on your computer and once you have
done that you can call <code>library(ggplot2)</code> again without
running into problems.</p>
</div>
<div id="data-upload" class="section level1">
<h1>Data Upload</h1>
<p>Make sure you have set the working directory to the directory in
which you saved your script file and the data file (see above). As we
are dealing with data in a csv file we will use the
<code>read.csv</code> function to load the data. We are lucky that this
datafile has no missing data, meaning that it has no empty cells.
Missing information all appear to be coded up as a special category in
each of the variables. See the <a
href="https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/995422/stats19.pdf">Data
Dictionary</a> to confirm that for the <code>RoadType</code> variable a
9 represents “Unknown”.</p>
<pre class="r"><code>accdata &lt;- read.csv(&quot;STATS19_GM_AccData.csv&quot;)</code></pre>
<p>It is well possible that you receive the following error message as
you execute this command “Error: <code>path</code> does not exist:
‘STATS19_GM_AccData.csv’”. The most likely reason for this is that the
“STATS19_GM_AccData.csv” is not saved in your working directory. Make
sure you download that file from Blackboard and save it in the working
directory you created earlier and you used in the <code>setwd()</code>
command. Also make sure that the file name used in the command here
matches exactly the file name in your folder.</p>
<p>Make sure that your data upload is successful. You should see an
object <code>accdata</code> in your environment. You can also run the
<code>str</code> (structure) function.</p>
<pre class="r"><code>str(accdata)  # prints some basic info on variables</code></pre>
<pre><code>## &#39;data.frame&#39;:    42624 obs. of  27 variables:
##  $ Accident.Index               : num  1.02e+11 1.02e+11 1.02e+11 1.07e+11 1.14e+11 ...
##  $ Year                         : int  2010 2010 2010 2010 2010 2010 2010 2010 2010 2010 ...
##  $ Severity                     : int  3 3 3 3 3 3 3 3 3 3 ...
##  $ NumberVehicles               : int  2 2 2 3 1 1 1 2 2 1 ...
##  $ NumberCasualties             : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ OutputDate                   : chr  &quot;01/01/2010&quot; &quot;01/01/2010&quot; &quot;01/01/2010&quot; &quot;01/01/2010&quot; ...
##  $ Day                          : int  6 6 6 6 6 6 7 7 7 7 ...
##  $ OutputTime                   : chr  &quot;13:10&quot; &quot;11:10&quot; &quot;17:30&quot; &quot;13:49&quot; ...
##  $ Easting                      : int  382347 381892 385840 377762 355982 362380 365767 381775 383868 384681 ...
##  $ Northing                     : int  390025 390582 403134 403302 404620 407476 405672 410735 394065 395127 ...
##  $ LocalAuthority               : int  102 102 102 107 114 114 100 101 102 102 ...
##  $ Road1Class                   : int  5 7 4 4 4 5 4 5 4 6 ...
##  $ Road1Number                  : int  5166 0 664 666 577 5239 58 6221 5103 0 ...
##  $ CarriagewayType              : int  3 6 3 3 6 6 6 6 3 6 ...
##  $ SpeedLimit                   : int  50 30 30 30 30 30 30 30 40 30 ...
##  $ JunctionDetail               : int  6 3 3 3 0 0 3 3 6 3 ...
##  $ JunctionControl              : int  2 4 4 4 0 0 2 4 2 4 ...
##  $ Road2Class                   : int  3 7 7 1 0 0 5 7 4 7 ...
##  $ Road2Number                  : int  5103 0 0 60 0 0 5235 0 6010 0 ...
##  $ PedCrossingHumanControl      : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ PedCrossingPhysicalFacilities: int  0 0 0 0 0 0 5 0 5 0 ...
##  $ LightingCondition            : int  1 1 4 3 7 4 4 1 4 4 ...
##  $ WeatherCondition             : int  1 1 1 9 9 1 1 3 3 8 ...
##  $ RoadSurface                  : int  4 4 2 1 1 4 4 3 2 4 ...
##  $ SpecialConditions            : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ CarriagewayHazard            : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ PlaceReported                : int  1 1 2 2 2 1 1 2 1 1 ...</code></pre>
<p>You should now see the <code>accdata</code> object in your
Environment (right hand pane).</p>
<p>There are 42,624 observations, each representing one recorded
accident in Greater Manchester (GM) between 2010 and 2020. Each accident
has variables which characterise the accident.</p>
<p>The following variables will be important for the analysis here:</p>
<ul>
<li><code>Accident.Index</code>, this is a unique identifier for each
accident</li>
<li><code>Year</code>, gives the year in which the accident
happened</li>
<li><code>Severity</code>, a variable coding the severity of the
accident, although we are unsure how this is coded</li>
<li><code>NumberVehicles</code>, number of vehicles involved in the
accident</li>
<li><code>NumberCasualties</code>, number of casualties involved in the
accident</li>
<li><code>LightingCondition</code>, Lighting conditions at time and
location of accident</li>
<li><code>WeatherCondition</code>, Weather conditions at time and
location of accident</li>
<li><code>Road1Class</code>, lower numbers indicating more major roads,
1 = Motorway</li>
<li><code>RoadSurface</code>, indicator of whether the road surface was
dry wet or icy at the time and place of the accident</li>
</ul>
<p>You wrote your first script. It is time to have another break. Make
sure you save your script and then close RStudio (you don’t need to do
that in general, but please do it at this point to help me demonstrate
the value of scripts). After relaxing for a few minutes and telling your
flatmate that you are on your way to become an expert data analyst, come
back and re-open RStudio. Load the script file (if it wasn’t loaded
automatically). The environment should, at this stage be empty, but if
you click on the “Source” button then R will automatically execute all
the commands you had in your script and <code>accdata</code> should be
available in the Environment panel.</p>
<p>So that is the value of scripts! You can easily pick up where you
left your work, no need to redo anything.</p>
</div>
<div id="accessing-data" class="section level1">
<h1>Accessing data</h1>
<p>The <code>accdata</code> item in your environment basically contains
the entire spreadsheet of data. You can look at the entire spreadsheet
by clicking on the tiny spreadsheet in the <code>accdata</code> line.
This will open a new tab with the spreadsheet. Have a look and then
close the tab again.</p>
<p>It is important to know how you can access subsets of data. Run
through the following commands to see what happens. Perhaps also
experiment a bit by changing the commands and predicting what the
outcome should be.</p>
<pre class="r"><code>accdata[1,]
accdata[,2]
accdata[3,4]
accdata[,4:6]
accdata[4:6]
accdata[2:4,5:10]
accdata$SpeedLimit
accdata$SpeedLimit[1:5]
accdata[c(&quot;SpeedLimit&quot;,&quot;Road1Class&quot;)]</code></pre>
<p>These are all different ways to select particular observations (rows
in a spreadsheet) and variables (columns in a spreadsheet). There were
two particular techniques which are important</p>
<ul>
<li><code>accdata$SpeedLimit</code> did address the
<code>SpeedLimit</code> variable in the <code>accdata</code> dataset
(<code>DATASET$VARIABLE</code>).</li>
<li><code>c("SpeedLimit","Road1Class")</code> allowed us to access two
very particular variables, ignoring all other 25 variables. It is useful
to know what <code>c("SpeedLimit","Road1Class")</code> actually
does.</li>
</ul>
<pre class="r"><code>c(&quot;SpeedLimit&quot;,&quot;Road1Class&quot;)</code></pre>
<pre><code>## [1] &quot;SpeedLimit&quot; &quot;Road1Class&quot;</code></pre>
<p>It creates a list with two elements, here two text strings. But you
can also create lists with numbers.</p>
<pre class="r"><code>c(3.5,2/3)</code></pre>
<pre><code>## [1] 3.50 0.67</code></pre>
<p>In fact you could even create lists which mixed datatypes.</p>
<pre class="r"><code>c(&quot;Countries in the EU&quot;, 28-1, &quot;:-(&quot;)</code></pre>
<pre><code>## [1] &quot;Countries in the EU&quot; &quot;27&quot;                  &quot;:-(&quot;</code></pre>
<p>Lists are quite fundamental to the way how R stores data. If you
assigned any of the above to a variable, for instance</p>
<pre class="r"><code>silly_list &lt;- c(&quot;Countries in the EU&quot;, 28-1, &quot;:-(&quot;)</code></pre>
<p>you would have saved it in the Environment and could re-use it.</p>
<p>All the commands in this section were really only to explore the
functionality of R. There is no need to save these in your script file.
But no harm either as none of these actually changed the values of the
data in <code>accdata</code>.</p>
</div>
<div id="do-not-change-your-original-data-sheet-here-the-csv-file"
class="section level1">
<h1>Do not change your original data sheet (here the csv file)</h1>
<p>An important principle of working with data here is that you should
never change your original datafile, which in this case the
<code>STATS19_GM_AccData.csv</code> file. As you can see from our work
so far we merely upload the csv file and then use the data here in R,
but we will not go back to the original csv file and change anything in
there. And that is very important. In that way you can always start
again with your analysis from your original data.</p>
<p>If you were to make any changes in your csv file, these changes would
be irreversible.</p>
</div>
<div id="investigate-data-1" class="section level1">
<h1>Investigate Data 1</h1>
<p>Let’s find out how the severity of an accident is coded like. If you
wish to find out what different values the variable takes in your
dataset you can easily see that with:</p>
<pre class="r"><code>unique(accdata$Severity)</code></pre>
<pre><code>## [1] 3 2 1</code></pre>
<p>But what do the values 1, 2 or 3 represent?</p>
<p>The usual advice would be to go to the data dictionary and check the
coding, but all we can see on the data entry form is the following</p>
<div class="float">
<img src="images/serious.png" style="width:50.0%"
alt="Seriousness info" />
<div class="figcaption">Seriousness info</div>
</div>
<p>But does a 1 in the <code>Severity</code> variable indicate a fatal
or a slight accident. We will have to check from the data itself. I am
sure you could come up with different ways of checking.</p>
<p>Presumably there will be mostly slight accidents and very few fatal
ones. So if we look up the number of accidents in each category it seems
reasonable to assume that the category with the largest number of
observations is the slight one.</p>
<p>The easiest way to look at this is to use the <code>table</code>
function on the <code>Severity</code> variable</p>
<pre class="r"><code>table(accdata$Severity)</code></pre>
<pre><code>## 
##     1     2     3 
##   582  6519 35523</code></pre>
<p>Judging from here it is apparent that category 1 is likely to be the
severe accident category and category 3 the slight one.</p>
</div>
<div id="data-formats" class="section level1">
<h1>Data Formats</h1>
<p>We can see (from the output to <code>str(accdata)</code>) that almost
all variables are integer (<code>int</code>) variables, i.e. the
software will treat them as whole numbers. Only the date and time
variables are text (character, <code>chr</code>) variables and the
<code>AAcidentIndex</code> is a <code>num</code> variable. Also numeric
but not restricted to whole numbers like <code>int</code>.</p>
<p>Recall that for most of the variables the numbers actually represent
categories. Like for the <code>Severity</code> variable where we
previously established that 1 = fatal, 2 = serious and 3 = slight. For
later it will be convenient to have <code>Severity</code> coded as a
variable which is not numeric, but a categorical variables. In other
words a variable which recognises that there are only limited possible
outcomes (here 3).</p>
<p>In R such variables are called <code>factor</code> variables. Hence
we will create a new variables, <code>Severityf</code> which contains
the same info, but just in a way easier to understand.</p>
<pre class="r"><code>accdata$Severityf &lt;- as.factor(accdata$Severity)  # translates a variable into a factor variable
levels(accdata$Severityf) &lt;- c(&quot;Fatal&quot;,&quot;Serious&quot;,&quot;Slight&quot;) # changes the names of the categories
table(accdata$Severityf)</code></pre>
<pre><code>## 
##   Fatal Serious  Slight 
##     582    6519   35523</code></pre>
<p>There are a number of important elements in these lines</p>
<ul>
<li><code>accdata$Severityf &lt;-</code> creates a new variable in the
<code>accdata</code> object, called <code>Severityf</code>.
<code>&lt;-</code> is called the assignment operator and it assigns some
value to that new variable. It will assign whatever comes to the right
hand side of <code>&lt;-</code></li>
<li><code>as.factor()</code> is a function called
<code>as.factor</code>. If you want to find out what a function does you
can call the help function <code>?as.factor</code>. This one creates a
variable as a factor (categorical) variable. But it requires an input
(Whatever comes inside the parenthesis). Here we ask R to use the
variable <code>accdata$Severity</code> to create a new factor variable
(<code>Severity</code> itself is an <code>int</code> variable).</li>
<li><code>levels(accdata$Severityf) &lt;- c("Fatal","Serious","Slight")</code>
then changes the names of the levels (categories) into sensible names.
Here we use again the assignment operator <code>&lt;-</code>. The order
matters, but we learn from the earlier analysis that: 1 = fatal, 2 =
serious and 3 = slight. As <code>Severity</code> is a numerical
(<code>int</code>) variable it will order the categories in numerical
order, 1 first and 3 last. In doubt you will have to check that you have
used the right ordering by comparing the <code>Severity</code> and
<code>Severityf</code> variable.</li>
</ul>
<p>Now create two new variables <code>WeatherConditionf</code> and
<code>RoadSurfacef</code> which achieve the same for the
<code>WeatherCondition</code> and <code>RoadSurface</code> variables.
Replace the <code>XXXX</code> to make this code work. You will have to
check the data dictionary for the right ordering. The general structure
of the lines will be:</p>
<pre class="r"><code>accdata$XXXX &lt;- as.factor(XXXX$XXXX)  
XXXX(accdata$XXXXf) XXXX c(XXXX) </code></pre>
<p>And let’s also check the number of accidents in the different weather
conditions and for different road surface conditions.</p>
<p>You did it right if you find that there were 246 accidents in “Snow,
no winds” condition as well as 31 accidents on flooded roads.</p>
<p>Make sure you save your script file.</p>
</div>
<div id="investigate-data-2" class="section level1">
<h1>Investigate Data 2</h1>
<p>We previously used the <code>table</code> function to characterise
the distribution of one variable. We can also use this function to
analyse the joint distribution of two variables (where we use the factor
variables we created previously).</p>
<pre class="r"><code>table(accdata$WeatherConditionf,accdata$Severityf)</code></pre>
<pre><code>##                 
##                  Fatal Serious Slight
##   Fine, no winds   458    5232  26845
##   Rain, no winds    67     786   5144
##   Snow, no winds     3      19    224
##   Fine, winds        9      56    339
##   Rain, winds       14     109    582
##   Snow, winds        1      12     52
##   Fog or mist        4      14     78
##   Other              6      63    790
##   Unknown           20     228   1469</code></pre>
<p>So you can see, for instance, that there were 9 fatal accidents when
the weather was fine with winds. It is often more instructive to look at
proportions rather than numbers. That is easily achieved by wrapping the
above line of code into the <code>prop.table</code> function.</p>
<pre class="r"><code>prop.table(table(accdata$WeatherConditionf,accdata$Severityf))</code></pre>
<pre><code>##                 
##                    Fatal Serious  Slight
##   Fine, no winds 1.1e-02 1.2e-01 6.3e-01
##   Rain, no winds 1.6e-03 1.8e-02 1.2e-01
##   Snow, no winds 7.0e-05 4.5e-04 5.3e-03
##   Fine, winds    2.1e-04 1.3e-03 8.0e-03
##   Rain, winds    3.3e-04 2.6e-03 1.4e-02
##   Snow, winds    2.3e-05 2.8e-04 1.2e-03
##   Fog or mist    9.4e-05 3.3e-04 1.8e-03
##   Other          1.4e-04 1.5e-03 1.9e-02
##   Unknown        4.7e-04 5.3e-03 3.4e-02</code></pre>
<p>Clearly this looks just a little too messy with the long numbers. You
can control in which format R outputs numbers</p>
<pre class="r"><code>options(digits = 2, scipen = 10)  # use ?options to understand what it does or just 
                                  # experiment with different values</code></pre>
<p>Let’s re-run the same line of code.</p>
<pre class="r"><code>prop.table(table(accdata$WeatherConditionf,accdata$Severity))</code></pre>
<pre><code>##                 
##                         1        2        3
##   Fine, no winds 0.010745 0.122748 0.629809
##   Rain, no winds 0.001572 0.018440 0.120683
##   Snow, no winds 0.000070 0.000446 0.005255
##   Fine, winds    0.000211 0.001314 0.007953
##   Rain, winds    0.000328 0.002557 0.013654
##   Snow, winds    0.000023 0.000282 0.001220
##   Fog or mist    0.000094 0.000328 0.001830
##   Other          0.000141 0.001478 0.018534
##   Unknown        0.000469 0.005349 0.034464</code></pre>
<p>You can now see that 63% of all accidents are slight accidents which
happen in fine weather with no winds. If you add up all these
proportions you will get 1.</p>
<p>This is still only moderatly insightful. Let’s try the following:</p>
<pre class="r"><code>prop.table(table(accdata$WeatherConditionf,accdata$Severity),2)</code></pre>
<pre><code>##                 
##                       1      2      3
##   Fine, no winds 0.7869 0.8026 0.7557
##   Rain, no winds 0.1151 0.1206 0.1448
##   Snow, no winds 0.0052 0.0029 0.0063
##   Fine, winds    0.0155 0.0086 0.0095
##   Rain, winds    0.0241 0.0167 0.0164
##   Snow, winds    0.0017 0.0018 0.0015
##   Fog or mist    0.0069 0.0021 0.0022
##   Other          0.0103 0.0097 0.0222
##   Unknown        0.0344 0.0350 0.0414</code></pre>
<p>You can now see that the proportions are calculated conditionally on
the severity of the accident. This is achieved by adding the “2” as an
optional input into the <code>prop.table</code> function. This tells the
function to calculate proportions conditional on the values in the 2nd
dimension (which are the columns).</p>
<p>Check what happens if you change the “2” to a “1”.</p>
<pre class="r"><code>prop.table(table(accdata$WeatherConditionf,accdata$Severity),1)</code></pre>
<pre><code>##                 
##                      1     2     3
##   Fine, no winds 0.014 0.161 0.825
##   Rain, no winds 0.011 0.131 0.858
##   Snow, no winds 0.012 0.077 0.911
##   Fine, winds    0.022 0.139 0.839
##   Rain, winds    0.020 0.155 0.826
##   Snow, winds    0.015 0.185 0.800
##   Fog or mist    0.042 0.146 0.812
##   Other          0.007 0.073 0.920
##   Unknown        0.012 0.133 0.856</code></pre>
<p>Does there seem to be any relation between the weather conditions and
the severity of the accident?</p>
<p>If you are looking at categorical variables only then looking at
tables of frequencies or proportions, as above, is the right way to go.
However, when you are interested in outcomes of variables which are
truly numerical, meaning that the actual number has a meaning (like the
number of vehicles and casualties involved), then looking at numbers of
frequencies may not be the best way to look at the variables. It may
make sense to look at some summary statistics like, means, medians and
standard deviations.</p>
</div>
<div id="a-simple-plot-tells-a-lot" class="section level1">
<h1>A Simple Plot Tells a Lot</h1>
<p>Here we are using the extremely powerful <code>ggplot</code>
function. This is not here to actually teach you how this works, but
just to wet your appetite.</p>
<pre class="r"><code>ggplot(accdata, aes(x = Easting, y=Northing)) + geom_point(size=0.5)</code></pre>
<p><img src="R_FirstSteps_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>You can basically see where in Manchester accidents happened. In
essence you can see the Manchester Road network. The next image adds a
few flourishes to the picture.</p>
<pre class="r"><code>ggplot(accdata, aes(x = Easting, y=Northing,color = Road1Class)) + 
  geom_point(size=0.5) +
  ggtitle(&quot;Locations of vehicle accidents in Greater Manchester&quot;)</code></pre>
<p><img src="R_FirstSteps_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
</div>
<div id="end-of-session" class="section level1">
<h1>End of session</h1>
<p>Before you leave RStudio you need to save your script file. That
means that tomorrow you can just come back open the script file and
continue to work.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
